"""Authentication endpoints."""

from typing import Annotated

from fastapi import APIRouter, Depends
from fastapi.security import OAuth2PasswordRequestForm

from {{cookiecutter.package_name}}_api.auth.jwt import create_access_token
from {{cookiecutter.package_name}}_api.auth.schemas import Token
from {{cookiecutter.package_name}}_api.exceptions import UnauthorizedError

router = APIRouter(prefix="/auth", tags=["auth"])


@router.post("/token", response_model=Token)
async def login(
    form_data: Annotated[OAuth2PasswordRequestForm, Depends()],
) -> Token:
    """Authenticate and get access token.

    This is a placeholder implementation. In a real application,
    you would validate credentials against your user database.

    Args:
        form_data: OAuth2 password request form with username and password.

    Returns:
        Access token response.

    Raises:
        UnauthorizedError: If credentials are invalid.
    """
    # TODO: Replace with actual user authentication logic
    # Example: user = await authenticate_user(form_data.username, form_data.password)
    # if not user:
    #     raise UnauthorizedError("Incorrect username or password")

    # Placeholder: Accept any non-empty credentials for demo purposes
    if not form_data.username or not form_data.password:
        raise UnauthorizedError("Username and password are required")

    access_token = create_access_token(data={"sub": form_data.username})
    return Token(access_token=access_token)
